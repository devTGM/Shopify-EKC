{% doc %}
  @prompt
    An interactive vertical Image with text where The image has the scroll effect wher the previous images stack behing the current image and each image has their respective text and CTA on their left
    
    The CTa button should be in center in Mobile View and has options to control the padding, Need option to control the image ratio, The previous text should fade once we scroll up/scroll down, the text is still overlapping, Image 1, Image 2, Image 3 and Iimage 4 should not overlap
{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-stack-scroll-{{ ai_gen_id }} {
    display: block;
    width: 100%;
    position: relative;
    padding: {{ block.settings.section_padding_top }}px 0 {{ block.settings.section_padding_bottom }}px;
  }

  .ai-stack-scroll-container-{{ ai_gen_id }} {
    width: 100%;
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px;
  }

  .ai-stack-scroll-item-{{ ai_gen_id }} {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 60px;
    align-items: center;
    min-height: 100vh;
    padding: 40px 0;
  }

  .ai-stack-scroll-content-{{ ai_gen_id }} {
    display: flex;
    flex-direction: column;
    gap: 24px;
    max-width: 600px;
    transition: opacity 0.4s ease, transform 0.4s ease;
  }

  .ai-stack-scroll-heading-{{ ai_gen_id }} {
    font-size: {{ block.settings.heading_size }}px;
    color: {{ block.settings.text_color }};
    margin: 0;
    line-height: 1.2;
  }

  .ai-stack-scroll-text-{{ ai_gen_id }} {
    font-size: {{ block.settings.text_size }}px;
    color: {{ block.settings.text_color }};
    line-height: 1.6;
    margin: 0;
  }

  .ai-stack-scroll-button-{{ ai_gen_id }} {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: {{ block.settings.button_padding_vertical }}px {{ block.settings.button_padding_horizontal }}px;
    background-color: {{ block.settings.button_bg_color }};
    color: {{ block.settings.button_text_color }};
    text-decoration: none;
    border-radius: {{ block.settings.button_border_radius }}px;
    font-size: {{ block.settings.button_text_size }}px;
    font-weight: 600;
    transition: all 0.3s ease;
    width: fit-content;
  }

  .ai-stack-scroll-button-{{ ai_gen_id }}:hover {
    background-color: {{ block.settings.button_hover_bg_color }};
    color: {{ block.settings.button_hover_text_color }};
  }

  .ai-stack-scroll-image-wrapper-{{ ai_gen_id }} {
    position: sticky;
    top: 80px;
    width: 100%;
    border-radius: {{ block.settings.image_border_radius }}px;
    overflow: hidden;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
  }

  {% if block.settings.image_ratio == 'custom' %}
    .ai-stack-scroll-image-wrapper-{{ ai_gen_id }} {
      height: {{ block.settings.image_height }}px;
    }
  {% else %}
    .ai-stack-scroll-image-wrapper-{{ ai_gen_id }} {
      aspect-ratio: {{ block.settings.image_ratio }};
    }
  {% endif %}

  .ai-stack-scroll-image-{{ ai_gen_id }} {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: opacity 0.6s ease;
  }

  .ai-stack-scroll-image-placeholder-{{ ai_gen_id }} {
    width: 100%;
    height: 100%;
    background-color: #f4f4f4;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
  }

  .ai-stack-scroll-image-placeholder-{{ ai_gen_id }} svg {
    width: 100%;
    height: 100%;
    max-width: 300px;
    max-height: 300px;
  }

  .ai-stack-scroll-empty-state-{{ ai_gen_id }} {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    padding: 12px 20px;
    font-size: 14px;
    color: #666;
    text-align: center;
    pointer-events: none;
  }

  @media screen and (max-width: 768px) {
    .ai-stack-scroll-item-{{ ai_gen_id }} {
      grid-template-columns: 1fr;
      gap: 30px;
      min-height: auto;
      padding: 60px 0;
    }

    .ai-stack-scroll-content-{{ ai_gen_id }} {
      order: 2;
      align-items: center;
      text-align: center;
    }

    .ai-stack-scroll-image-wrapper-{{ ai_gen_id }} {
      order: 1;
      position: relative;
      top: 0;
    }

    {% if block.settings.image_ratio == 'custom' %}
      .ai-stack-scroll-image-wrapper-{{ ai_gen_id }} {
        height: {{ block.settings.image_height | times: 0.7 }}px;
      }
    {% endif %}

    .ai-stack-scroll-button-{{ ai_gen_id }} {
      width: auto;
    }

    .ai-stack-scroll-heading-{{ ai_gen_id }} {
      font-size: {{ block.settings.heading_size | times: 0.7 }}px;
    }

    .ai-stack-scroll-text-{{ ai_gen_id }} {
      font-size: {{ block.settings.text_size | times: 0.9 }}px;
    }
  }
{% endstyle %}

<stack-scroll-{{ ai_gen_id }} class="ai-stack-scroll-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  <div class="ai-stack-scroll-container-{{ ai_gen_id }}">
    {% for i in (1..4) %}
      {% liquid
        assign image_key = 'image_' | append: i
        assign heading_key = 'heading_' | append: i
        assign text_key = 'text_' | append: i
        assign button_text_key = 'button_text_' | append: i
        assign button_link_key = 'button_link_' | append: i

        assign image = block.settings[image_key]
        assign heading = block.settings[heading_key]
        assign text = block.settings[text_key]
        assign button_text = block.settings[button_text_key]
        assign button_link = block.settings[button_link_key]
      %}

      <div class="ai-stack-scroll-item-{{ ai_gen_id }}" data-index="{{ i }}">
        <div class="ai-stack-scroll-content-{{ ai_gen_id }}">
          {% if heading != blank %}
            <h2 class="ai-stack-scroll-heading-{{ ai_gen_id }}">{{ heading }}</h2>
          {% endif %}

          {% if text != blank %}
            <div class="ai-stack-scroll-text-{{ ai_gen_id }}">{{ text }}</div>
          {% endif %}

          {% if button_text != blank %}
            <a
              href="{{ button_link | default: '#' }}"
              class="ai-stack-scroll-button-{{ ai_gen_id }}"
            >
              {{ button_text }}
            </a>
          {% endif %}
        </div>

        <div class="ai-stack-scroll-image-wrapper-{{ ai_gen_id }}">
          {% if image %}
            <img
              src="{{ image | image_url: width: 1200 }}"
              alt="{{ image.alt | escape }}"
              loading="lazy"
              width="{{ image.width }}"
              height="{{ image.height }}"
              class="ai-stack-scroll-image-{{ ai_gen_id }}"
              data-image-index="{{ i }}"
            >
          {% else %}
            <div class="ai-stack-scroll-image-placeholder-{{ ai_gen_id }}">
              {{ 'image' | placeholder_svg_tag }}
              <div class="ai-stack-scroll-empty-state-{{ ai_gen_id }}">
                Add image {{ i }}
              </div>
            </div>
          {% endif %}
        </div>
      </div>
    {% endfor %}
  </div>
</stack-scroll-{{ ai_gen_id }}>

<script>
  (function() {
    class StackScroll{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.items = [];
        this.images = [];
      }

      connectedCallback() {
        this.items = Array.from(this.querySelectorAll('.ai-stack-scroll-item-{{ ai_gen_id }}'));
        this.images = Array.from(this.querySelectorAll('.ai-stack-scroll-image-{{ ai_gen_id }}'));
        
        if (window.innerWidth <= 768) {
          return;
        }

        this.handleScroll();
        window.addEventListener('scroll', () => this.handleScroll());
      }

      handleScroll() {
        this.items.forEach((item, index) => {
          const rect = item.getBoundingClientRect();
          const content = item.querySelector('.ai-stack-scroll-content-{{ ai_gen_id }}');
          
          if (!content) return;

          const windowHeight = window.innerHeight;
          const itemTop = rect.top;
          const itemBottom = rect.bottom;
          const itemCenter = itemTop + rect.height / 2;

          if (itemCenter >= 0 && itemCenter <= windowHeight) {
            content.style.opacity = '1';
            content.style.transform = 'translateY(0)';
            this.showImage(index + 1);
          } else if (itemTop < 0 && itemBottom > windowHeight * 0.3) {
            const fadeProgress = Math.abs(itemTop) / (rect.height * 0.5);
            const opacity = Math.max(0, 1 - fadeProgress);
            const translateY = fadeProgress * 30;
            
            content.style.opacity = opacity.toString();
            content.style.transform = 'translateY(-' + translateY + 'px)';
          } else if (itemTop > windowHeight) {
            content.style.opacity = '0';
            content.style.transform = 'translateY(30px)';
          } else {
            content.style.opacity = '0';
            content.style.transform = 'translateY(-30px)';
          }
        });
      }

      showImage(activeIndex) {
        this.images.forEach((img) => {
          const imgIndex = parseInt(img.getAttribute('data-image-index'));
          if (imgIndex === activeIndex) {
            img.style.opacity = '1';
          } else {
            img.style.opacity = '0';
          }
        });
      }

      disconnectedCallback() {
        window.removeEventListener('scroll', () => this.handleScroll());
      }
    }

    customElements.define('stack-scroll-{{ ai_gen_id }}', StackScroll{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Stacking scroll images",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Section spacing"
    },
    {
      "type": "range",
      "id": "section_padding_top",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Top padding",
      "default": 50
    },
    {
      "type": "range",
      "id": "section_padding_bottom",
      "min": 0,
      "max": 100,
      "step": 5,
      "unit": "px",
      "label": "Bottom padding",
      "default": 50
    },
    {
      "type": "header",
      "content": "Image 1"
    },
    {
      "type": "image_picker",
      "id": "image_1",
      "label": "Image"
    },
    {
      "type": "inline_richtext",
      "id": "heading_1",
      "label": "Heading",
      "default": "Discover Our Collection"
    },
    {
      "type": "richtext",
      "id": "text_1",
      "label": "Text",
      "default": "<p>Explore our carefully curated selection of premium products designed to elevate your lifestyle.</p>"
    },
    {
      "type": "text",
      "id": "button_text_1",
      "label": "Button text",
      "default": "Shop Now"
    },
    {
      "type": "url",
      "id": "button_link_1",
      "label": "Button link"
    },
    {
      "type": "header",
      "content": "Image 2"
    },
    {
      "type": "image_picker",
      "id": "image_2",
      "label": "Image"
    },
    {
      "type": "inline_richtext",
      "id": "heading_2",
      "label": "Heading",
      "default": "Quality Craftsmanship"
    },
    {
      "type": "richtext",
      "id": "text_2",
      "label": "Text",
      "default": "<p>Every piece is crafted with attention to detail and built to last.</p>"
    },
    {
      "type": "text",
      "id": "button_text_2",
      "label": "Button text",
      "default": "Learn More"
    },
    {
      "type": "url",
      "id": "button_link_2",
      "label": "Button link"
    },
    {
      "type": "header",
      "content": "Image 3"
    },
    {
      "type": "image_picker",
      "id": "image_3",
      "label": "Image"
    },
    {
      "type": "inline_richtext",
      "id": "heading_3",
      "label": "Heading",
      "default": "Sustainable Materials"
    },
    {
      "type": "richtext",
      "id": "text_3",
      "label": "Text",
      "default": "<p>We're committed to using eco-friendly materials and ethical production methods.</p>"
    },
    {
      "type": "text",
      "id": "button_text_3",
      "label": "Button text",
      "default": "Our Story"
    },
    {
      "type": "url",
      "id": "button_link_3",
      "label": "Button link"
    },
    {
      "type": "header",
      "content": "Image 4"
    },
    {
      "type": "image_picker",
      "id": "image_4",
      "label": "Image"
    },
    {
      "type": "inline_richtext",
      "id": "heading_4",
      "label": "Heading",
      "default": "Join Our Community"
    },
    {
      "type": "richtext",
      "id": "text_4",
      "label": "Text",
      "default": "<p>Become part of a community that values quality, style, and sustainability.</p>"
    },
    {
      "type": "text",
      "id": "button_text_4",
      "label": "Button text",
      "default": "Get Started"
    },
    {
      "type": "url",
      "id": "button_link_4",
      "label": "Button link"
    },
    {
      "type": "header",
      "content": "Typography"
    },
    {
      "type": "range",
      "id": "heading_size",
      "min": 20,
      "max": 80,
      "step": 2,
      "unit": "px",
      "label": "Heading size",
      "default": 48
    },
    {
      "type": "range",
      "id": "text_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Text size",
      "default": 16
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text color",
      "default": "#000000"
    },
    {
      "type": "header",
      "content": "Button style"
    },
    {
      "type": "range",
      "id": "button_padding_vertical",
      "min": 8,
      "max": 30,
      "step": 2,
      "unit": "px",
      "label": "Vertical padding",
      "default": 14
    },
    {
      "type": "range",
      "id": "button_padding_horizontal",
      "min": 16,
      "max": 60,
      "step": 4,
      "unit": "px",
      "label": "Horizontal padding",
      "default": 32
    },
    {
      "type": "range",
      "id": "button_text_size",
      "min": 12,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Text size",
      "default": 16
    },
    {
      "type": "range",
      "id": "button_border_radius",
      "min": 0,
      "max": 50,
      "step": 2,
      "unit": "px",
      "label": "Border radius",
      "default": 4
    },
    {
      "type": "color",
      "id": "button_bg_color",
      "label": "Background color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Text color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "button_hover_bg_color",
      "label": "Hover background color",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "button_hover_text_color",
      "label": "Hover text color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Image style"
    },
    {
      "type": "select",
      "id": "image_ratio",
      "label": "Aspect ratio",
      "options": [
        {
          "value": "1/1",
          "label": "Square (1:1)"
        },
        {
          "value": "4/3",
          "label": "Landscape (4:3)"
        },
        {
          "value": "3/4",
          "label": "Portrait (3:4)"
        },
        {
          "value": "16/9",
          "label": "Widescreen (16:9)"
        },
        {
          "value": "9/16",
          "label": "Vertical (9:16)"
        },
        {
          "value": "3/2",
          "label": "Classic (3:2)"
        },
        {
          "value": "2/3",
          "label": "Tall (2:3)"
        },
        {
          "value": "custom",
          "label": "Custom height"
        }
      ],
      "default": "4/3"
    },
    {
      "type": "range",
      "id": "image_height",
      "min": 300,
      "max": 900,
      "step": 50,
      "unit": "px",
      "label": "Custom height",
      "default": 600,
      "info": "Only applies when aspect ratio is set to Custom height"
    },
    {
      "type": "range",
      "id": "image_border_radius",
      "min": 0,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Border radius",
      "default": 12
    }
  ],
  "presets": [
    {
      "name": "Stacking scroll images"
    }
  ]
}
{% endschema %}
